%% HMTL
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Bellybutton Biodiversity</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>

<body>

  <div class="container">
    <div class="row">
      <div class="col-md-12 p-5 text-center bg-light">
        <h1>Belly Button Biodiversity Dashboard</h1>
        <p>Use the interactive charts below to explore the dataset</p>
      </div>
    </div>
    <br>
    <div class="row">
      <div class="col-md-3">
        <div class="card card-body bg-light">
          <h6>Test Subject ID Number:</h6>
          <select id="selDataset" onchange="optionChanged(this.value)"></select>
        </div>
        <br>
        <div class="card card-primary">
          <div class="card-header">
            <h4 class="card-title">Demographic Info</h4>
          </div>
          <div id="sample-metadata" class="card-body"></div>
        </div>
      </div>
      <div class="col-md-9">
        <div id="bar"></div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
        <div id="bubble"></div>
      </div>
    </div>
  </div>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="./static/js/app.js"></script>

</body>

</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 14 Challenge</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>
</head>
<body>

    <h1>Module 14 Challenge</h1>
    <div>
        <label for="selDataset">Test Subject ID:</label>
        <select id="selDataset"></select>
    </div>
    <div id="sample-metadata"></div>
    <div id="bar"></div>
    <div id="bubble"></div>
    <div id="gauge"></div>

    <script>
        // Define the URL as a constant
        const url = 'https://2u-data-curriculum-team.s3.amazonaws.com/dataviz-classroom/v1.1/14-Interactive-Web-Visualizations/02-Homework/samples.json';

        // Use d3 to load dataset and call the init function
        d3.json(url).then(init).catch(error => console.log(error));

        // Initialize function to set up dropdown and initial charts
        function init(data) {
            // Create dropdown menu with d3 and select data
            let dropdownMenu = d3.select('#selDataset');
            // Retrieve sample names from data
            let samples = data.names;
            // Append options to the dropdown menu
            samples.forEach(id => {
                dropdownMenu.append('option').text(id).property('value', id);
            });
            // Event listener for dropdown change
            dropdownMenu.on('change', optionChanged);

            // Initialize with the first sample
            let firstSample = samples[0];
            // Build initial charts and metadata
            buildBarChart(firstSample, data);
            buildBubbleChart(firstSample, data);
            buildMetadata(firstSample, data);
            buildGaugeChart(data.metadata.find(d => d.id == firstSample).wfreq);
        }

        // Function to build the horizontal bar chart
        function buildBarChart(id, data) {
            let individualData = data.samples.find(sample => sample.id === id);
            let top10OTUs = individualData.otu_ids.slice(0, 10).reverse();
            let top10Counts = individualData.sample_values.slice(0, 10).reverse();
            let top10Labels = individualData.otu_labels.slice(0, 10).reverse();

            let bar_data = [{
                x: top10Counts,
                y: top10OTUs.map(otu => `OTU ${otu}`),
                type: "bar",
                text: top10Labels,
                orientation: "h"
            }];
            
            let layout = {
                title: "Top 10 OTUs",
                height: 400,
                width: 800
            };
            
            Plotly.newPlot("bar", bar_data, layout);
        }

        // Function to build the bubble chart
        function buildBubbleChart(id, data) {
            let individualData = data.samples.find(sample => sample.id === id);

            let bubble_data = [{
                x: individualData.otu_ids,
                y: individualData.sample_values,
                mode: "markers",
                marker: {
                    color: individualData.otu_ids,
                    size: individualData.sample_values
                },
                text: individualData.otu_labels
            }];
            
            let layout = {
                title: "Bacteria in Sample",
                height: 500,
                width: 1000,
                xaxis: {
                    title: "OTU ID"
                },
                yaxis: {
                    title: "Sample Value"
                }
            };
            
            Plotly.newPlot("bubble", bubble_data, layout);
        }

        // Function to build the metadata panel
        function buildMetadata(sample, data) {
            let individualData = data.metadata.find(metadata => metadata.id === sample);
            let panel = d3.select("#sample-metadata");
            panel.html("");
            let table = panel.append("table").classed("table", true);
            
            Object.entries(individualData).forEach(([key, value]) => {
                let row = table.append("tr");
                row.append("td").text(key);
                row.append("td").text(value);
            });
        }

        // Function to update charts and metadata on dropdown change
        function optionChanged() {
            let selectedSample = d3.select('#selDataset').property('value');
            d3.json(url).then(data => {
                buildBarChart(selectedSample, data);
                buildBubbleChart(selectedSample, data);
                buildMetadata(selectedSample, data);
                buildGaugeChart(data.metadata.find(d => d.id == selectedSample).wfreq);
            });
        }

        // Function to build the gauge chart
        function buildGaugeChart(value) {
            let data = [{
                domain: { x: [0, 1], y: [0, 1] },
                value: value,
                title: { text: "Belly Button Washing Frequency<br><sub>Scrubs per Week</sub>" },
                type: "indicator",
                mode: "gauge+number",
                gauge: {
                    axis: { range: [null, 9] },
                    bar: { color: "rgb(200,200,200)" },
                    bgcolor: "white",
                    borderwidth: 2,
                    bordercolor: "gray",
                    steps: [
                        { range: [0, 1], color: 'rgb(230, 240, 215)' },
                        { range: [1, 2], color: 'rgb(200, 230, 180)' },
                        { range: [2, 3], color: 'rgb(170, 220, 140)' },
                        { range: [3, 4], color: 'rgb(110, 190, 85)' },
                        { range: [4, 5], color: 'rgb(80, 180, 60)' },
                        { range: [5, 6], color: 'rgb(50, 160, 50)' },
                        { range: [6, 7], color: 'rgb(20, 140, 40)' },
                        { range: [7, 8], color: 'rgb(0, 120, 30)' },
                        { range: [8, 9], color: 'rgb(0, 100, 20)' }
                    ]
                }
            }];
            
            let layout = {
                width: 600,
                height: 450,
                margin: { t: 25, r: 25, l: 25, b: 25 },
                paper_bgcolor: "white",
                font: { color: "darkblue", family: "Arial" }
            };
            
            Plotly.newPlot('gauge', data, layout);
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Belly Button Biodiversity Dashboard</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div>
        <select id="selDataset" onchange="optionChanged(this.value)"></select>
    </div>
    <div id="sample-metadata"></div>
    <div id="bar"></div>
    <div id="bubble"></div>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            d3.json("https://2u-data-curriculum-team.s3.amazonaws.com/dataviz-classroom/v1.1/14-Interactive-Web-Visualizations/02-Homework/samples.json").then((data) => {
                console.log("Data loaded:", data); // Log the entire dataset to debug

                // Populate the dropdown menu
                var select = d3.select("#selDataset");
                data.names.forEach((name) => {
                    select.append("option").text(name).property("value", name);
                });

                // Add event listener for the dropdown menu change
                select.on("change", function () {
                    var newSample = d3.select(this).property("value");
                    optionChanged(newSample);
                });

                // Initialize the page with the first sample
                var firstSample = data.names[0];
                buildCharts(firstSample);
                buildMetadata(firstSample);
            });

            // Function to build the metadata panel
            function buildMetadata(sample) {
                d3.json("https://2u-data-curriculum-team.s3.amazonaws.com/dataviz-classroom/v1.1/14-Interactive-Web-Visualizations/02-Homework/samples.json").then((data) => {
                    var metadata = data.metadata;
                    var resultArray = metadata.filter(sampleObj => sampleObj.id == sample);
                    var result = resultArray[0];
                    console.log("Metadata result:", result); // Log the result to debug

                    var PANEL = d3.select("#sample-metadata");

                    // Clear any existing metadata
                    PANEL.html("");

                    if (result) {
                        // Add each key-value pair to the panel
                        Object.entries(result).forEach(([key, value]) => {
                            PANEL.append("h6").text(`${key.toUpperCase()}: ${value}`);
                        });
                    } else {
                        PANEL.append("h6").text("No metadata found for this sample");
                    }
                });
            }

            // Function to build the charts
            function buildCharts(sample) {
                d3.json("https://2u-data-curriculum-team.s3.amazonaws.com/dataviz-classroom/v1.1/14-Interactive-Web-Visualizations/02-Homework/samples.json").then((data) => {
                    var samples = data.samples;
                    var resultArray = samples.filter(sampleObj => sampleObj.id == sample);
                    var result = resultArray[0];
                    console.log("Sample result:", result); // Log the result to debug

                    if (result) {
                        var otu_ids = result.otu_ids;
                        var otu_labels = result.otu_labels;
                        var sample_values = result.sample_values;

                        // Build a Bar Chart
                        var yticks = otu_ids.slice(0, 10).map(otuID => `OTU ${otuID}`).reverse();
                        var barData = [{
                            y: yticks,
                            x: sample_values.slice(0, 10).reverse(),
                            text: otu_labels.slice(0, 10).reverse(),
                            type: "bar",
                            orientation: "h"
                        }];

                        var barLayout = {
                            title: "Top 10 Bacteria Cultures Found",
                            margin: { t: 30, l: 150 }
                        };

                        Plotly.newPlot("bar", barData, barLayout);

                        // Build a Bubble Chart
                        var bubbleData = [{
                            x: otu_ids,
                            y: sample_values,
                            text: otu_labels,
                            mode: 'markers',
                            marker: {
                                size: sample_values,
                                color: otu_ids,
                                colorscale: 'Earth'
                            }
                        }];

                        var bubbleLayout = {
                            title: 'Bacteria Cultures Per Sample',
                            showlegend: false,
                            height: 600,
                            width: 1200,
                            xaxis: { title: 'OTU ID' },
                            hovermode: 'closest'
                        };

                        Plotly.newPlot('bubble', bubbleData, bubbleLayout);
                    } else {
                        console.error("No sample data found for this sample ID");
                    }
                });
            }

            // Function to handle changes in the dropdown selection
            function optionChanged(newSample) {
                console.log("New sample selected:", newSample);
                buildCharts(newSample);
                buildMetadata(newSample);
            }
        });
    </script>
</body>
</html>

